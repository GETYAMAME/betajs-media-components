/*!
betajs-media-components - v0.0.38 - 2016-11-06
Copyright (c) Ziggeo,Oliver Friedmann
Apache-2.0 Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.MediaComponents"),a.binding("base","global:BetaJS"),a.binding("browser","global:BetaJS.Browser"),a.binding("flash","global:BetaJS.Flash"),a.binding("media","global:BetaJS.Media"),a.binding("dynamics","global:BetaJS.Dynamics"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"7a20804e-be62-4982-91c6-98eb096d2e70",version:"52.1478470089468"}}),a.assumeVersion("base:version",502),a.assumeVersion("browser:version",78),a.assumeVersion("flash:version",33),a.assumeVersion("dynamics:version",251),a.assumeVersion("media:version",57),a.extend("module:Templates",function(){return{video_player_controlbar:' <div class="{{css}}-dashboard {{activitydelta > 5000 && hideonactivity ? (css + \'-dashboard-hidden\') : \'\'}}">  <div class="{{css}}-progressbar {{activitydelta < 2500 || ismobile ? \'\' : (css + \'-progressbar-small\')}}"       onmousedown="{{startUpdatePosition(domEvent)}}"       onmouseup="{{stopUpdatePosition(domEvent)}}"       onmouseleave="{{stopUpdatePosition(domEvent)}}"       onmousemove="{{progressUpdatePosition(domEvent)}}">   <div class="{{css}}-progressbar-cache" ba-styles="{{{width: Math.round(duration ? cached / duration * 100 : 0) + \'%\'}}}"></div>   <div class="{{css}}-progressbar-position" ba-styles="{{{width: Math.round(duration ? position / duration * 100 : 0) + \'%\'}}}" title="{{string(\'video-progress\')}}">    <div class="{{css}}-progressbar-button"></div>   </div>  </div>  <div class="{{css}}-backbar"></div>  <div class="{{css}}-controlbar">         <div class="{{css}}-leftbutton-container" ba-if="{{submittable}}"  ba-click="submit()">             <div class="{{css}}-button-inner">                 {{string(\'submit-video\')}}             </div>         </div>         <div class="{{css}}-leftbutton-container" ba-if="{{rerecordable}}"  ba-click="rerecord()" title="{{string(\'rerecord-video\')}}">             <div class="{{css}}-button-inner">                 <i class="{{css}}-icon-ccw"></i>             </div>         </div>   <div class="{{css}}-leftbutton-container" ba-if="{{!playing}}" ba-click="play()" title="{{string(\'play-video\')}}">    <div class="{{css}}-button-inner">     <i class="{{css}}-icon-play"></i>    </div>   </div>   <div class="{{css}}-leftbutton-container" ba-if="{{playing}}" ba-click="pause()" title="{{string(\'pause-video\')}}">             <div class="{{css}}-button-inner">                 <i class="{{css}}-icon-pause"></i>             </div>   </div>   <div class="{{css}}-time-container">    <div class="{{css}}-time-value" title="{{string(\'elapsed-time\')}}">{{position_formatted}}</div>    <div class="{{css}}-time-sep">/</div>    <div class="{{css}}-time-value" title="{{string(\'total-time\')}}">{{duration_formatted}}</div>   </div>   <div class="{{css}}-rightbutton-container" ba-if="{{fullscreen}}" ba-click="toggle_fullscreen()" title="{{string(\'fullscreen-video\')}}">    <div class="{{css}}-button-inner">     <i class="{{css}}-icon-resize-full"></i>    </div>   </div>   <div class="{{css}}-rightbutton-container" ba-if="{{streams.length > 1 && currentstream}}" ba-click="toggle_stream()" title="{{string(\'change-resolution\')}}">    <div class="{{css}}-button-inner">     <span class="{{css}}-button-text">{{currentstream_label}}</span>    </div>   </div>   <div class="{{css}}-volumebar">    <div class="{{css}}-volumebar-inner"         onmousedown="{{startUpdateVolume(domEvent)}}"                  onmouseup="{{stopUpdateVolume(domEvent)}}"                  onmouseleave="{{stopUpdateVolume(domEvent)}}"                  onmousemove="{{progressUpdateVolume(domEvent)}}">     <div class="{{css}}-volumebar-position" ba-styles="{{{width: Math.min(100, Math.round(volume * 100)) + \'%\'}}}">         <div class="{{css}}-volumebar-button" title="{{string(\'volume-button\')}}"></div>     </div>        </div>   </div>   <div class="{{css}}-rightbutton-container" ba-click="toggle_volume()" title="{{string(volume > 0 ? \'volume-mute\' : \'volume-unmute\')}}">    <div class="{{css}}-button-inner">     <i class="{{css + \'-icon-volume-\' + (volume >= 0.5 ? \'up\' : (volume > 0 ? \'down\' : \'off\')) }}"></i>    </div>   </div>  </div> </div> ',video_player_loader:' <div class="{{css}}-loader-container">     <div class="{{css}}-loader-loader" title="{{string(\'tooltip\')}}">     </div> </div>',video_player_message:' <div class="{{css}}-message-container" ba-click="click()">     <div class=\'{{css}}-message-message\'>         {{message}}     </div> </div>',playbutton:' <div class="{{css}}-playbutton-container" ba-click="play()" title="{{string(\'tooltip\')}}">  <div class="{{css}}-playbutton-button"></div> </div>  <div class="{{css}}-rerecord-bar" ba-if="{{rerecordable || submittable}}">  <div class="{{css}}-rerecord-backbar"></div>  <div class="{{css}}-rerecord-frontbar">         <div class="{{css}}-rerecord-button-container" ba-if="{{submittable}}">             <div class="{{css}}-rerecord-button" onclick="{{submit()}}">                 {{string(\'submit-video\')}}             </div>         </div>         <div class="{{css}}-rerecord-button-container" ba-if="{{rerecordable}}">          <div class="{{css}}-rerecord-button" onclick="{{rerecord()}}">           {{string(\'rerecord\')}}          </div>         </div>  </div> </div> ',player:' <div     class="{{css}}-container {{css}}-size-{{csssize}} {{iecss}}-{{ie8 ? \'ie8\' : \'noie8\'}} {{csstheme}}"     ba-on:mousemove="user_activity()"     ba-on:mousedown="user_activity()"     ba-on:touchstart="user_activity()"     style="{{width ? \'width:\' + width + ((width + \'\').match(/^\\d+$/g) ? \'px\' : \'\') + \';\' : \'\'}}{{height ? \'height:\' + height + ((height + \'\').match(/^\\d+$/g) ? \'px\' : \'\') + \';\' : \'\'}}" >     <video class="{{css}}-video" data-video="video"></video>     <div class="{{css}}-overlay" data-video="ad" style="display:none"></div>     <div class=\'{{css}}-overlay\'>      <ba-{{dyncontrolbar}}       ba-css="{{csscontrolbar || css}}"       ba-template="{{tmplcontrolbar}}"       ba-show="{{controlbar_active}}"       ba-playing="{{playing}}"       ba-event:rerecord="rerecord"       ba-event:submit="submit"       ba-event:play="play"       ba-event:pause="pause"       ba-event:position="seek"       ba-event:volume="set_volume"       ba-event:fullscreen="toggle_fullscreen"       ba-volume="{{volume}}"       ba-duration="{{duration}}"       ba-cached="{{buffered}}"       ba-position="{{position}}"       ba-activitydelta="{{activity_delta}}"       ba-hideoninactivity="{{hideoninactivity}}"       ba-rerecordable="{{rerecordable}}"       ba-submittable="{{submittable}}"       ba-streams="{{streams}}"       ba-currentstream="{{=currentstream}}"       ba-fullscreen="{{fullscreensupport && !nofullscreen}}"       ba-source="{{source}}"   ></ba-{{dyncontrolbar}}>      <ba-{{dynplaybutton}}       ba-css="{{cssplaybutton || css}}"       ba-template="{{tmplplaybutton}}"       ba-show="{{playbutton_active}}"       ba-rerecordable="{{rerecordable}}"       ba-submittable="{{submittable}}"       ba-event:play="playbutton_click"       ba-event:rerecord="rerecord"       ba-event:submit="submit"   ></ba-{{dynplaybutton}}>      <ba-{{dynloader}}       ba-css="{{cssloader || css}}"       ba-template="{{tmplloader}}"       ba-show="{{loader_active}}"   ></ba-{{dynloader}}>      <ba-{{dynmessage}}       ba-css="{{cssmessage || css}}"       ba-template="{{tmplmessage}}"       ba-show="{{message_active}}"       ba-message="{{message}}"       ba-event:click="message_click"   ></ba-{{dynmessage}}>    <ba-{{dyntopmessage}}       ba-css="{{csstopmessage || css}}"       ba-template="{{tmpltopmessage}}"       ba-show="{{topmessage}}"       ba-topmessage="{{topmessage}}"   ></ba-{{dyntopmessage}}>     </div> </div> ',video_player_topmessage:" <div class=\"{{css}}-topmessage-container\">     <div class='{{css}}-topmessage-background'>     </div>     <div class='{{css}}-topmessage-message'>         {{topmessage}}     </div> </div>",video_recorder_chooser:' <div class="{{css}}-chooser-container">   <div class="{{css}}-chooser-button-container">   <div>    <div class="{{css}}-chooser-primary-button"         ba-click="primary()"         ba-if="{{has_primary}}">     <input ba-if="{{enable_primary_select && primary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{primary_select(domEvent)}}"            accept="{{primary_accept_string}}"            capture />     <input ba-if="{{enable_primary_select && !primary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{primary_select(domEvent)}}"            accept="{{primary_accept_string}}" />     <i class="{{css}}-icon-{{primaryrecord ? \'videocam\' : \'upload\'}}"></i>     <span>      {{primary_label}}     </span>    </div>   </div>   <div>    <div class="{{css}}-chooser-secondary-button"         ba-click="secondary()"         ba-if="{{has_secondary}}">     <input ba-if="{{enable_secondary_select && secondary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{secondary_select(domEvent)}}"            accept="{{secondary_accept_string}}" />     <input ba-if="{{enable_secondary_select && !secondary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{secondary_select(domEvent)}}"            accept="{{secondary_accept_string}}" />     <span>      {{secondary_label}}     </span>    </div>   </div>  </div> </div>',video_recorder_controlbar:'<div class="{{css}}-dashboard">  <div class="{{css}}-backbar"></div>  <div class="{{css}}-settings" ba-show="{{settingsvisible && settingsopen}}">   <div class="{{css}}-settings-backbar"></div>   <div class="{{css}}-settings-front">    <ul ba-repeat="{{camera :: cameras}}">     <li>      <input type=\'radio\' name=\'camera\' value="{{selectedcamera == camera.id}}" onclick="{{selectCamera(camera.id)}}" />      <span></span>      <label onclick="{{selectCamera(camera.id)}}">       {{camera.label}}      </label>      </li>    </ul>    <hr ba-show="{{!noaudio}}"/>    <ul ba-repeat="{{microphone :: microphones}}" ba-show="{{!noaudio}}">     <li onclick="{{selectMicrophone(microphone.id)}}">      <input type=\'radio\' name=\'microphone\' value="{{selectedmicrophone == microphone.id}}" />      <span></span>      <label>       {{microphone.label}}      </label>      </li>    </ul>   </div>  </div>  <div class="{{css}}-controlbar">         <div class="{{css}}-leftbutton-container" ba-show="{{settingsvisible}}">             <div class="{{css}}-button-inner {{css}}-button-{{settingsopen ? \'selected\' : \'unselected\'}}"                  onclick="{{settingsopen=!settingsopen}}"                  onmouseenter="{{hover(string(\'settings\'))}}"                  onmouseleave="{{unhover()}}">                 <i class="{{css}}-icon-cog"></i>             </div>         </div>         <div class="{{css}}-lefticon-container" ba-show="{{settingsvisible}}">             <div class="{{css}}-icon-inner"                  onmouseenter="{{hover(string(camerahealthy ? \'camerahealthy\' : \'cameraunhealthy\'))}}"                  onmouseleave="{{unhover()}}">                 <i class="{{css}}-icon-videocam {{css}}-icon-state-{{camerahealthy ? \'good\' : \'bad\' }}"></i>             </div>         </div>         <div class="{{css}}-lefticon-container" ba-show="{{settingsvisible && !noaudio}}">             <div class="{{css}}-icon-inner"                  onmouseenter="{{hover(string(microphonehealthy ? \'microphonehealthy\' : \'microphoneunhealthy\'))}}"                  onmouseleave="{{unhover()}}">                 <i class="{{css}}-icon-mic {{css}}-icon-state-{{microphonehealthy ? \'good\' : \'bad\' }}"></i>             </div>         </div>         <div class="{{css}}-lefticon-container" ba-show="{{stopvisible && recordingindication}}">             <div class="{{css}}-recording-indication">             </div>         </div>         <div class="{{css}}-label-container" ba-show="{{controlbarlabel}}">          <div class="{{css}}-label-label">           {{controlbarlabel}}          </div>         </div>         <div class="{{css}}-rightbutton-container" ba-show="{{recordvisible}}">          <div class="{{css}}-button-primary"                  onclick="{{record()}}"                  onmouseenter="{{hover(string(\'record-tooltip\'))}}"                  onmouseleave="{{unhover()}}">           {{string(\'record\')}}          </div>         </div>         <div class="{{css}}-rightbutton-container" ba-if="{{uploadcovershotvisible}}">          <div class="{{css}}-button-primary"                  onmouseenter="{{hover(string(\'upload-covershot-tooltip\'))}}"                  onmouseleave="{{unhover()}}">                  <input type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{uploadCovershot(domEvent)}}"            accept="{{covershot_accept_string}}" />                  <span>            {{string(\'upload-covershot\')}}           </span>          </div>         </div>         <div class="{{css}}-rightbutton-container" ba-show="{{rerecordvisible}}">          <div class="{{css}}-button-primary"                  onclick="{{rerecord()}}"                  onmouseenter="{{hover(string(\'rerecord-tooltip\'))}}"                  onmouseleave="{{unhover()}}">           {{string(\'rerecord\')}}          </div>         </div>         <div class="{{css}}-rightbutton-container" ba-show="{{stopvisible}}">          <div class="{{css}}-button-primary"                  onclick="{{stop()}}"                  onmouseenter="{{hover(string(\'stop-tooltip\'))}}"                  onmouseleave="{{unhover()}}">           {{string(\'stop\')}}          </div>         </div>         <div class="{{css}}-centerbutton-container" ba-show="{{skipvisible}}">          <div class="{{css}}-button-primary"                  onclick="{{skip()}}"                  onmouseenter="{{hover(string(\'skip-tooltip\'))}}"                  onmouseleave="{{unhover()}}">           {{string(\'skip\')}}          </div>         </div>  </div> </div> ',video_recorder_imagegallery:'<div class="{{css}}-imagegallery-leftbutton">  <div class="{{css}}-imagegallery-button-inner" onclick="{{left()}}">   <i class="ba-videorecorder-icon-left-open"></i>  </div> </div>   <div ba-repeat="{{image::images}}" class="{{css}}-imagegallery-container" data-gallery-container>      <div class="{{css}}-imagegallery-image"           ba-styles="{{{left: image.left + \'px\', top: image.top + \'px\', width: image.width + \'px\', height: image.height + \'px\'}}}"           onclick="{{select(image)}}">      </div> </div>   <div class="{{css}}-imagegallery-rightbutton">  <div class="{{css}}-imagegallery-button-inner" onclick="{{right()}}">   <i class="ba-videorecorder-icon-right-open"></i>  </div> </div> ',video_recorder_loader:' <div class="{{css}}-loader-container">     <div class="{{css}}-loader-loader" title="{{tooltip}}">     </div> </div> <div class="{{css}}-loader-label" ba-show="{{label}}">  {{label}} </div>',video_recorder_message:' <div class="{{css}}-message-container" ba-click="click()">     <div class=\'{{css}}-message-message\'>         {{message || ""}}     </div> </div>',recorder:' <div ba-show="{{!player_active}}"      class="{{css}}-container {{css}}-size-{{csssize}} {{iecss}}-{{ie8 ? \'ie8\' : \'noie8\'}} {{csstheme}}"      style="{{width ? \'width:\' + width + ((width + \'\').match(/^\\d+$/g) ? \'px\' : \'\') + \';\' : \'width:100%;\'}}{{height ? \'height:\' + height + ((height + \'\').match(/^\\d+$/g) ? \'px\' : \'\') + \';\' : \'height:100%\'}}" >       <video class="{{css}}-video {{css}}-{{hasrecorder ? \'hasrecorder\' : \'norecorder\'}}" data-video="video"></video>     <div class=\'{{css}}-overlay\' ba-show="{{!hideoverlay}}" data-overlay="overlay">   <ba-{{dynloader}}       ba-css="{{cssloader || css}}"       ba-template="{{tmplloader}}"       ba-show="{{loader_active}}"       ba-tooltip="{{loadertooltip}}"       ba-label="{{loaderlabel}}"   ></ba-{{dynloader}}>      <ba-{{dynmessage}}       ba-css="{{cssmessage || css}}"       ba-template="{{tmplmessage}}"       ba-show="{{message_active}}"       ba-message="{{message}}"       ba-event:click="message_click"   ></ba-{{dynmessage}}>    <ba-{{dyntopmessage}}       ba-css="{{csstopmessage || css}}"       ba-template="{{tmpltopmessage}}"       ba-show="{{topmessage_active && (topmessage || hovermessage)}}"       ba-topmessage="{{hovermessage || topmessage}}"   ></ba-{{dyntopmessage}}>      <ba-{{dynchooser}}       ba-css="{{csschooser || css}}"       ba-template="{{tmplchooser}}"       ba-show="{{chooser_active}}"       ba-allowrecord="{{allowrecord}}"       ba-allowupload="{{allowupload}}"       ba-allowcustomupload="{{allowcustomupload}}"       ba-primaryrecord="{{primaryrecord}}"       ba-event:record="record_video"       ba-event:upload="upload_video"   ></ba-{{dynchooser}}>      <ba-{{dynimagegallery}}       ba-css="{{cssimagegallery || css}}"       ba-template="{{tmplimagegallery}}"       ba-if="{{imagegallery_active}}"       ba-imagecount="{{gallerysnapshots}}"       ba-imagenativewidth="{{recordingwidth}}"       ba-imagenativeheight="{{recordingheight}}"       ba-event:image-selected="select_image"   ></ba-{{dynimagegallery}}>      <ba-{{dyncontrolbar}}       ba-css="{{csscontrolbar || css}}"       ba-template="{{tmplcontrolbar}}"       ba-show="{{controlbar_active}}"       ba-cameras="{{cameras}}"       ba-microphones="{{microphones}}"       ba-noaudio="{{noaudio}}"       ba-selectedcamera="{{selectedcamera || 0}}"       ba-selectedmicrophone="{{selectedmicrophone || 0}}"       ba-camerahealthy="{{camerahealthy}}"       ba-microphonehealthy="{{microphonehealthy}}"       ba-hovermessage="{{=hovermessage}}"       ba-settingsvisible="{{settingsvisible}}"       ba-recordvisible="{{recordvisible}}"       ba-uploadcovershotvisible="{{uploadcovershotvisible}}"       ba-rerecordvisible="{{rerecordvisible}}"       ba-stopvisible="{{stopvisible}}"       ba-skipvisible="{{skipvisible}}"       ba-controlbarlabel="{{controlbarlabel}}"       ba-event:select-camera="select_camera"       ba-event:select-microphone="select_microphone"       ba-event:invoke-record="record"       ba-event:invoke-rerecord="rerecord"       ba-event:invoke-stop="stop"       ba-event:invoke-skip="invoke_skip"       ba-event:upload-covershot="upload_covershot"   ></ba-{{dyncontrolbar}}>     </div> </div>  <div ba-if="{{player_active}}"      style="{{width ? \'width:\' + width + ((width + \'\').match(/^\\d+$/g) ? \'px\' : \'\') + \';\' : \'\'}}{{height ? \'height:\' + height + ((height + \'\').match(/^\\d+$/g) ? \'px\' : \'\') + \';\' : \'\'}}" >  <ba-{{dynvideoplayer}} ba-theme="{{theme || \'default\'}}"                         ba-source="{{playbacksource}}"                         ba-poster="{{playbackposter}}"                         ba-hideoninactivity="{{false}}"                         ba-forceflash="{{forceflash}}"                         ba-noflash="{{noflash}}"                         ba-stretch="{{stretch}}"                         ba-attrs="{{playerattrs}}"                         ba-data:id="player"                         ba-width="{{width}}"                         ba-height="{{height}}"                         ba-rerecordable="{{rerecordable && (recordings === null || recordings > 0)}}"                         ba-submittable="{{manualsubmit}}"                         ba-reloadonplay="{{true}}"                         ba-autoplay="{{autoplay}}"                         ba-nofullscreen="{{nofullscreen}}"                         ba-topmessage="{{playertopmessage}}"                         ba-event:rerecord="rerecord"                         ba-event:playing="playing"                         ba-event:paused="paused"                         ba-event:ended="ended"                         ba-event:submit="manual_submit"                         >  </ba-{{dynvideoplayer}}> </div>',video_recorder_topmessage:" <div class=\"{{css}}-topmessage-container\">     <div class='{{css}}-topmessage-background'>     </div>     <div class='{{css}}-topmessage-message'>         {{topmessage}}     </div> </div>","modern-video_player_controlbar":' <div class="{{css}}-dashboard {{activitydelta > 5000 && hideoninactivity ? (css + \'-dashboard-hidden\') : \'\'}}">         <div class="{{css}}-leftbutton-container" ba-if="{{submittable}}"  ba-click="submit()">             <div class="{{css}}-button-inner">                 {{string(\'submit-video\')}}             </div>         </div>        <div class="{{css}}-leftbutton-container" ba-if="{{rerecordable}}" ba-click="rerecord()" title="{{string(\'rerecord-video\')}}">            <div class="{{css}}-button-inner">                <i class="{{css}}-icon-ccw"></i>            </div>        </div>  <div class="{{css}}-leftbutton-container" ba-if="{{!playing}}" ba-click="play()" title="{{string(\'play-video\')}}">   <div class="{{css}}-button-inner">    <i class="{{css}}-icon-play"></i>   </div>  </div>  <div class="{{css}}-leftbutton-container" ba-if="{{playing}}" ba-click="pause()" title="{{string(\'pause-video\')}}">    <div class="{{css}}-button-inner">    <i class="{{css}}-icon-pause"></i>   </div>  </div>  <div class="{{css}}-time-container">   <div class="{{css}}-time-value" title="{{string(\'elapsed-time\')}}">{{position_formatted}}/{{duration_formatted}}</div>  </div>  <div class="{{css}}-rightbutton-container" ba-if="{{fullscreen}}" ba-click="toggle_fullscreen()" title="{{string(\'fullscreen-video\')}}">   <div class="{{css}}-button-inner">    <i class="{{css}}-icon-resize-full"></i>   </div>  </div>  <div class="{{css}}-rightbutton-container" ba-if="{{streams.length > 1 && currentstream}}" ba-click="toggle_stream()" title="{{string(\'change-resolution\')}}">   <div class="{{css}}-button-inner">    <span class="{{css}}-button-text">{{currentstream_label}}</span>   </div>  </div>  <div class="{{css}}-volumebar">   <div class="{{css}}-volumebar-inner"           onmousedown="{{startUpdateVolume(domEvent)}}"                 onmouseup="{{stopUpdateVolume(domEvent)}}"                 onmouseleave="{{stopUpdateVolume(domEvent)}}"                 onmousemove="{{progressUpdateVolume(domEvent)}}">    <div class="{{css}}-volumebar-position" ba-styles="{{{width: Math.ceil(1+Math.min(99, Math.round(volume * 100))) + \'%\'}}}" title="{{string(\'volume-button\')}}"></div>       </div>  </div>  <div class="{{css}}-rightbutton-container {{css}}-volume-button-container" ba-click="toggle_volume()" title="{{string(volume > 0 ? \'volume-mute\' : \'volume-unmute\')}}">   <div class="{{css}}-button-inner">    <i class="{{css + \'-icon-volume-\' + (volume >= 0.5 ? \'up\' : (volume > 0 ? \'down\' : \'off\')) }}"></i>   </div>  </div>  <div class="{{css}}-progressbar">   <div class="{{css}}-progressbar-inner"        onmousedown="{{startUpdatePosition(domEvent)}}"        onmouseup="{{stopUpdatePosition(domEvent)}}"        onmouseleave="{{stopUpdatePosition(domEvent)}}"        onmousemove="{{progressUpdatePosition(domEvent)}}">   <div class="{{css}}-progressbar-cache" ba-styles="{{{width: Math.round(duration ? cached / duration * 100 : 0) + \'%\'}}}"></div>   <div class="{{css}}-progressbar-position" ba-styles="{{{width: Math.round(duration ? position / duration * 100 : 0) + \'%\'}}}" title="{{string(\'video-progress\')}}"></div>  </div> </div> ',"modern-video_recorder_chooser":' <div class="{{css}}-chooser-container">   <div class="{{css}}-chooser-button-container">     <div class="{{css}}-chooser-icon-container">    <i class="{{css}}-icon-{{primaryrecord ? \'videocam\' : \'upload\'}}"></i>   </div>   <div>    <div class="{{css}}-chooser-primary-button"         ba-click="primary()"         ba-if="{{has_primary}}">     <input ba-if="{{enable_primary_select && primary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{primary_select(domEvent)}}"            accept="{{primary_accept_string}}"            capture />     <input ba-if="{{enable_primary_select && !primary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{primary_select(domEvent)}}"            accept="{{primary_accept_string}}" />     <span>      {{primary_label}}     </span>    </div>   </div>   <div>    <div class="{{css}}-chooser-secondary-button"         ba-click="secondary()"         ba-if="{{has_secondary}}">     <input ba-if="{{enable_secondary_select && secondary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{secondary_select(domEvent)}}"            accept="{{secondary_accept_string}}" />     <input ba-if="{{enable_secondary_select && !secondary_select_capture}}"            type="file"            class="{{css}}-chooser-file"            style="height:100"            onchange="{{secondary_select(domEvent)}}"            accept="{{secondary_accept_string}}" />     <span>      {{secondary_label}}     </span>    </div>   </div>  </div> </div>'}}),a.extend("module:Assets",["module:Assets"],function(a){var b={"language:de":{"ba-videoplayer-playbutton.tooltip":"Hier clicken um Wiedergabe zu starten.","ba-videoplayer-playbutton.rerecord":"Video neu aufnehmen","ba-videoplayer-playbutton.submit-video":"Video akzeptieren","ba-videoplayer-loader.tooltip":"Video wird geladen...","ba-videoplayer-controlbar.change-resolution":"Aufl&#xF6;sung anpassen","ba-videoplayer-controlbar.video-progress":"Videofortschritt","ba-videoplayer-controlbar.rerecord-video":"Video erneut aufnehmen?","ba-videoplayer-controlbar.submit-video":"Video akzeptieren","ba-videoplayer-controlbar.play-video":"Video wiedergeben","ba-videoplayer-controlbar.pause-video":"Video pausieren","ba-videoplayer-controlbar.elapsed-time":"Vergangene Zeit","ba-videoplayer-controlbar.total-time":"L&#xE4;nge des Videos","ba-videoplayer-controlbar.fullscreen-video":"Vollbildmodus","ba-videoplayer-controlbar.volume-button":"Lautst&#xE4;rke regulieren","ba-videoplayer-controlbar.volume-mute":"Ton abstellen","ba-videoplayer-controlbar.volume-unmute":"Ton wieder einstellen","ba-videoplayer.video-error":"Es ist ein Fehler aufgetreten, bitte versuchen Sie es sp&#xE4;ter noch einmal. Hier klicken, um es noch einmal zu probieren.","ba-videorecorder-chooser.record-video":"Video aufnehmen","ba-videorecorder-chooser.upload-video":"Video hochladen","ba-videorecorder-controlbar.settings":"Einstellungen","ba-videorecorder-controlbar.camerahealthy":"Gute Beleuchtung","ba-videorecorder-controlbar.cameraunhealthy":"Beleuchtung nicht optimal","ba-videorecorder-controlbar.microphonehealthy":"Soundqualit&#xE4;t einwandfrei","ba-videorecorder-controlbar.microphoneunhealthy":"Mikrofon bis jetzt stumm","ba-videorecorder-controlbar.record":"Video aufnehmen","ba-videorecorder-controlbar.record-tooltip":"Hier clicken um Aufnahme zu starten.","ba-videorecorder-controlbar.rerecord":"Video neu aufnehmen","ba-videorecorder-controlbar.rerecord-tooltip":"Hier clicken um Video erneut aufzunehmen.","ba-videorecorder-controlbar.upload-covershot":"Hochladen","ba-videorecorder-controlbar.upload-covershot-tooltip":"Hier clicken um einen Covershot hochzuladen.","ba-videorecorder-controlbar.stop":"Aufnahme stoppen","ba-videorecorder-controlbar.stop-tooltip":"Hier clicken um Aufnahme zu stoppen.","ba-videorecorder-controlbar.skip":"&#xDC;berspringen","ba-videorecorder-controlbar.skip-tooltip":"Hier clicken um zu &#xDC;berspringen.","ba-videorecorder.recorder-error":"Es ist ein Fehler aufgetreten, bitte versuchen Sie es sp&#xE4;ter noch einmal. Hier klicken, um es noch einmal zu probieren.","ba-videorecorder.attach-error":"Wir konnten nicht auf die Kamera zugreifen. Je nach Browser und Ger&#xE4;t muss m&#xF6;glicherweise Flash installiert oder die Seite &#xFC;ber SSL geladen werden.","ba-videorecorder.access-forbidden":"Kamerazugriff wurde verweigert. Hier klick, um es noch einmal zu probieren.","ba-videorecorder.pick-covershot":"Bitte w&#xE4;hlen Sie einen Covershot aus.","ba-videorecorder.uploading":"Hochladen","ba-videorecorder.uploading-failed":"Hochladen fehlgeschlagen. Hier klicken, um es noch einmal zu probieren.","ba-videorecorder.verifying":"Verifizieren","ba-videorecorder.verifying-failed":"Verifizierung fehlgeschlagen. Hier klicken, um es noch einmal zu probieren.","ba-videorecorder.rerecord-confirm":"M&#xF6;chten Sie Ihr Video wirklich noch einmal aufnehmen?","ba-videorecorder.video_file_too_large":"Die angegebene Videodatei ist zu gro&#xDF;. Hier klicken, um eine kleinere Videodatei hochzuladen.","ba-videorecorder.unsupported_video_type":"Bitte laden Sie Dateien des folgenden Typs hoch: %s. Hier klicken, um es noch einmal zu probieren."}};for(var c in b)a.strings.register(b[c],[c]);return{}}),a.define("module:Ads.AdSenseVideoAdProvider",["module:Ads.AbstractVideoAdProvider","module:Ads.AdSensePrerollAd"],function(a,b,c){return a.extend({scoped:c},{_newPrerollAd:function(a){return new b(this,a)}})}),a.define("module:Ads.AdSensePrerollAd",["module:Ads.AbstractPrerollAd"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,b,c),this._adDisplayContainer=new google.ima.AdDisplayContainer(this._options.adElement,this._options.videoElement),this._adDisplayContainer.initialize(),this._adsLoader=new google.ima.AdsLoader(this._adDisplayContainer);var d=this;this._adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(){d._adError()},!1),this._adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(){d._adLoaded.apply(d,arguments)},!1),this._adsRequest=new google.ima.AdsRequest,this._adsRequest.adTagUrl=this._provider.options().adTagUrl},_executeAd:function(a){this._adsRequest.linearAdSlotWidth=a.width,this._adsRequest.linearAdSlotHeight=a.height,this._adsLoader.requestAds(this._adsRequest)},_adError:function(){this._adsManager&&this._adsManager.destroy(),this._adFinished()},_adLoaded:function(a){this._adsManager=a.getAdsManager(this._options.videoElement);try{this._adsManager.init(this._adsRequest.linearAdSlotWidth,this._adsRequest.linearAdSlotHeight,google.ima.ViewMode.NORMAL),this._adsManager.start()}catch(b){}var c=this;this._adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(){c._adError()},!1),this._adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(){c._adFinished()})}}})}),a.define("module:Ads.AbstractVideoAdProvider",["base:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this._options=b},options:function(){return this._options},_newPrerollAd:function(a){},newPrerollAd:function(a){return this._newPrerollAd(a)},register:function(a){this.cls.registry[a]=this}}},{registry:{}})}),a.define("module:Ads.AbstractPrerollAd",["base:Class","base:Events.EventsMixin","jquery:"],function(a,b,c,d){return a.extend({scoped:d},[b,function(a){return{constructor:function(b,c){a.constructor.call(this),this._provider=b,this._options=c},executeAd:function(a){c(this._options.adElement).show(),this._executeAd(a)},_adFinished:function(){c(this._options.adElement).hide(),this.trigger("finished")}}}])}),a.define("module:Assets",["base:Classes.LocaleTable","browser:Info"],function(a,b){var c=new a;return c.setWeakLocale(b.language()),{strings:c,playerthemes:{},recorderthemes:{}}}),a.define("module:VideoPlayer.Dynamics.Controlbar",["dynamics:Dynamic","base:TimeFormat","base:Comparators","module:Templates","jquery:","module:Assets","browser:Info","media:Player.Support"],["dynamics:Partials.StylesPartial","dynamics:Partials.ShowPartial","dynamics:Partials.IfPartial","dynamics:Partials.ClickPartial"],function(a,b,c,d,e,f,g,h,i){
return a.extend({scoped:i},function(a){return{template:d.video_player_controlbar,attrs:{css:"ba-videoplayer",duration:0,position:0,cached:0,volume:1,expandedprogress:!0,playing:!1,rerecordable:!1,submittable:!1,streams:[],currentstream:null,fullscreen:!0,activitydelta:0},computed:{"currentstream_label:currentstream":function(){var a=this.get("currentstream");return a?a.label?a.label:h.resolutionToLabel(a.width,a.height):""}},functions:{startUpdatePosition:function(a){a[0].preventDefault(),this.set("_updatePosition",!0),this.call("progressUpdatePosition",a)},progressUpdatePosition:function(a){a[0].preventDefault(),this.get("_updatePosition")&&(this.set("position",this.get("duration")*(a[0].clientX-e(a[0].currentTarget).offset().left)/e(a[0].currentTarget).width()),this.trigger("position",this.get("position")))},stopUpdatePosition:function(a){a[0].preventDefault(),this.set("_updatePosition",!1)},startUpdateVolume:function(a){a[0].preventDefault(),this.set("_updateVolume",!0),this.call("progressUpdateVolume",a)},progressUpdateVolume:function(a){a[0].preventDefault(),this.get("_updateVolume")&&(this.set("volume",(a[0].clientX-e(a[0].currentTarget).offset().left)/e(a[0].currentTarget).width()),this.trigger("volume",this.get("volume")))},stopUpdateVolume:function(a){a[0].preventDefault(),this.set("_updateVolume",!1)},play:function(){this.trigger("play")},pause:function(){this.trigger("pause")},toggle_volume:function(){this.get("volume")>0?(this.__oldVolume=this.get("volume"),this.set("volume",0)):this.set("volume",this.__oldVolume||1),this.trigger("volume",this.get("volume"))},toggle_fullscreen:function(){this.trigger("fullscreen")},rerecord:function(){this.trigger("rerecord")},submit:function(){this.set("submittable",!1),this.set("rerecordable",!1),this.trigger("submit")},toggle_stream:function(){var a=this.get("streams"),b=a.length-1;a.forEach(function(a,d){c.deepEqual(a,this.get("currentstream"))&&(b=d)},this),this.set("currentstream",a[(b+1)%a.length])}},create:function(){this.properties().compute("position_formatted",function(){return b.format(b.ELAPSED_MINUTES_SECONDS,1e3*this.get("position"))},["position"]),this.properties().compute("duration_formatted",function(){return b.format(b.ELAPSED_MINUTES_SECONDS,1e3*this.get("duration"))},["duration"]),this.set("ismobile",g.isMobile())}}}).register("ba-videoplayer-controlbar").attachStringTable(f.strings).addStrings({"video-progress":"Video progress","rerecord-video":"Redo video?","submit-video":"Confirm video","play-video":"Play video","pause-video":"Pause video","elapsed-time":"Elasped time","total-time":"Total length of video","fullscreen-video":"Enter fullscreen","volume-button":"Set volume","volume-mute":"Mute sound","volume-unmute":"Unmute sound","change-resolution":"Change resolution"})}),a.define("module:VideoPlayer.Dynamics.Loader",["dynamics:Dynamic","module:Templates","module:Assets"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{template:b.video_player_loader,attrs:{css:"ba-videoplayer"}}}).register("ba-videoplayer-loader").attachStringTable(c.strings).addStrings({tooltip:"Loading video..."})}),a.define("module:VideoPlayer.Dynamics.Message",["dynamics:Dynamic","module:Templates"],["dynamics:Partials.ClickPartial"],function(a,b,c){return a.extend({scoped:c},function(a){return{template:b.video_player_message,attrs:{css:"ba-videoplayer",message:""},functions:{click:function(){this.trigger("click")}}}}).register("ba-videoplayer-message")}),a.define("module:VideoPlayer.Dynamics.Playbutton",["dynamics:Dynamic","module:Templates","module:Assets"],["dynamics:Partials.ClickPartial"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{template:b.playbutton,attrs:{css:"ba-videoplayer",rerecordable:!1,submittable:!1},functions:{play:function(){this.trigger("play")},submit:function(){this.set("submittable",!1),this.set("rerecordable",!1),this.trigger("submit")},rerecord:function(){this.trigger("rerecord")}}}}).register("ba-videoplayer-playbutton").attachStringTable(c.strings).addStrings({tooltip:"Click to play video.",rerecord:"Redo","submit-video":"Confirm video"})}),a.define("module:VideoPlayer.Dynamics.Player",["dynamics:Dynamic","module:Templates","module:Assets","browser:Info","media:Player.VideoPlayerWrapper","base:Types","base:Objs","base:Strings","base:Time","base:Timers","base:States.Host","base:Classes.ClassRegistry","module:VideoPlayer.Dynamics.PlayerStates.Initial","module:VideoPlayer.Dynamics.PlayerStates","module:Ads.AbstractVideoAdProvider"],["module:VideoPlayer.Dynamics.Playbutton","module:VideoPlayer.Dynamics.Message","module:VideoPlayer.Dynamics.Loader","module:VideoPlayer.Dynamics.Controlbar","dynamics:Partials.EventPartial","dynamics:Partials.OnPartial","dynamics:Partials.TemplatePartial"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return a.extend({scoped:p},function(a){return{template:b.player,attrs:{css:"ba-videoplayer",iecss:"ba-videoplayer",cssplaybutton:"",cssloader:"",cssmessage:"",csstopmessage:"",csscontrolbar:"",width:"",height:"",theme:"",csstheme:"",dynplaybutton:"videoplayer-playbutton",dynloader:"videoplayer-loader",dynmessage:"videoplayer-message",dyntopmessage:"videoplayer-topmessage",dyncontrolbar:"videoplayer-controlbar",tmplplaybutton:"",tmplloader:"",tmplmessage:"",tmpltopmessage:"",tmplcontrolbar:"",poster:"",source:"",sources:[],sourcefilter:{},streams:[],currentstream:null,playlist:null,volume:1,forceflash:!1,noflash:!1,reloadonplay:!1,adprovider:null,preroll:!1,rerecordable:!1,submittable:!1,autoplay:!1,preload:!1,loop:!1,nofullscreen:!1,ready:!0,stretch:!1,hideoninactivity:!0,skipinitial:!1,topmessage:"",states:{poster_error:{ignore:!1,click_play:!0}}},types:{forceflash:"boolean",noflash:"boolean",rerecordable:"boolean",loop:"boolean",autoplay:"boolean",preload:"boolean",ready:"boolean",nofullscreen:"boolean",stretch:"boolean",preroll:"boolean",hideoninactivity:"boolean",skipinitial:"boolean",volume:"float"},extendables:["states"],remove_on_destroy:!0,create:function(){if(d.isMobile()&&(this.set("autoplay",!1),this.set("loop",!1)),this.get("theme")in c.playerthemes&&g.iter(c.playerthemes[this.get("theme")],function(a,b){this.isArgumentAttr(b)||this.set(b,a)},this),this.get("adprovider")&&(this._adProvider=this.get("adprovider"),f.is_string(this._adProvider)&&(this._adProvider=o.registry[this._adProvider])),this.get("playlist")){var a=this.get("playlist")[0];this.set("poster",a.poster),this.set("source",a.source),this.set("sources",a.sources)}this.get("streams")&&!this.get("currentstream")&&this.set("currentstream",this.get("streams")[0]),this.set("ie8",d.isInternetExplorer()&&d.internetExplorerVersion()<9),this.set("duration",0),this.set("position",0),this.set("buffered",0),this.set("message",""),this.set("fullscreensupport",!1),this.set("csssize","normal"),this.set("loader_active",!1),this.set("playbutton_active",!1),this.set("controlbar_active",!1),this.set("message_active",!1),this.set("last_activity",i.now()),this.set("activity_delta",0),this.set("playing",!1),this.__attachRequested=!1,this.__activated=!1,this.__error=null,this.__currentStretch=null,this.on("change:stretch",function(){this._updateStretch()},this),this.host=this.auto_destroy(new k({stateRegistry:new l(this.cls.playerStates())})),this.host.dynamic=this,this.host.initialize(m),this._timer=this.auto_destroy(new j.Timer({context:this,fire:this._timerFire,delay:100,start:!0})),this.properties().compute("buffering",function(){return this.get("playing")&&this.get("buffered")<this.get("position")&&this.get("last_position_change_delta")>1e3},["buffered","position","last_position_change_delta","playing"])},state:function(){return this.host.state()},videoAttached:function(){return!!this.player},videoLoaded:function(){return this.videoAttached()&&this.player.loaded()},videoError:function(){return this.__error},_error:function(a,b){this.__error={error_type:a,error_code:b},this.trigger("error:"+a,b),this.trigger("error",a,b)},_clearError:function(){this.__error=null},_detachVideo:function(){this.set("playing",!1),this.player&&this.player.weakDestroy(),this._prerollAd&&this._prerollAd.weakDestroy(),this.player=null},_attachVideo:function(){if(!this.videoAttached()){if(!this.__activated)return void(this.__attachRequested=!0);this.__attachRequested=!1;var a=this.element().find("[data-video='video']").get(0);this._clearError(),e.create(g.extend(this._getSources(),{element:a,forceflash:!!this.get("forceflash"),noflash:!!this.get("noflash"),preload:!!this.get("preload"),loop:!!this.get("loop"),reloadonplay:!!this.get("reloadonplay")})).error(function(a){this.destroyed()||this._error("attach",a)},this).success(function(a){this.destroyed()||(this._adProvider&&this.get("preroll")&&(this._prerollAd=this._adProvider.newPrerollAd({videoElement:this.element().find("[data-video='video']").get(0),adElement:this.element().find("[data-video='ad']").get(0)})),this.player=a,this.player.on("postererror",function(){this._error("poster")},this),this.player.on("playing",function(){this.set("playing",!0),this.trigger("playing")},this),this.player.on("error",function(a){this._error("video",a)},this),this.player.error()&&this.player.trigger("error",this.player.error()),this.player.on("paused",function(){this.set("playing",!1),this.trigger("paused")},this),this.player.on("ended",function(){this.set("playing",!1),this.trigger("ended")},this),this.trigger("attached",a),this.player.once("loaded",function(){var a=Math.min(1,this.get("volume"));this.player.setVolume(a),this.player.setMuted(0>=a),this.set("duration",this.player.duration()),this.set("fullscreensupport",this.player.supportsFullscreen()),this.trigger("loaded"),this._updateStretch()},this),this.player.loaded()&&this.player.trigger("loaded"),this._updateStretch())},this)}},_getSources:function(){var a=this.get("currentstream")?this.get("currentstream").filter:this.get("sourcefilter"),b=this.get("poster"),c=this.get("source"),d=a?g.filter(this.get("sources"),function(b){return g.subset_of(a,b)},this):this.get("sources");return g.iter(d,function(a){a.poster&&(b=a.poster)}),{poster:b,source:c,sources:d}},_afterActivate:function(b){a._afterActivate.call(this,b),this.__activated=!0,this.__attachRequested&&this._attachVideo()},reattachVideo:function(){this._detachVideo(),this._attachVideo()},object_functions:["play","rerecord","pause","stop","seek","set_volume"],functions:{user_activity:function(){this.set("last_activity",i.now()),this.set("activity_delta",0)},message_click:function(){this.trigger("message:click")},playbutton_click:function(){this.host.state().play()},play:function(){this.host.state().play()},rerecord:function(){this.get("rerecordable")&&this.trigger("rerecord")},submit:function(){this.get("submittable")&&(this.trigger("submit"),this.set("submittable",!1),this.set("rerecordable",!1))},pause:function(){this.get("playing")&&this.player.pause()},stop:function(){this.videoLoaded()&&(this.get("playing")&&this.player.pause(),this.player.setPosition(0),this.trigger("stopped"))},seek:function(a){this.videoLoaded()&&this.player.setPosition(a),this.trigger("seek",a)},set_volume:function(a){a=Math.min(1,a),this.set("volume",a),this.videoLoaded()&&(this.player.setVolume(a),this.player.setMuted(0>=a))},toggle_fullscreen:function(){this.videoLoaded()&&this.player.enterFullscreen()}},destroy:function(){this._detachVideo(),a.destroy.call(this)},_timerFire:function(){if(!this.destroyed()){try{if(this.videoLoaded()){this.set("activity_delta",i.now()-this.get("last_activity"));var a=this.player.position();(a!=this.get("position")||this.get("last_position_change"))&&this.set("last_position_change",i.now()),this.set("last_position_change_delta",i.now()-this.get("last_position_change")),this.set("position",a),this.set("buffered",this.player.buffered()),this.set("duration",this.player.duration())}}catch(b){}this._updateStretch(),this._updateCSSSize()}},_updateCSSSize:function(){this.set("csssize",this.element().width()>400?"normal":this.element().width()>300?"medium":"small")},videoHeight:function(){return this.videoAttached()?this.player.videoHeight():NaN},videoWidth:function(){return this.videoAttached()?this.player.videoWidth():NaN},aspectRatio:function(){return this.videoWidth()/this.videoHeight()},parentWidth:function(){return this.activeElement().parent().width()},parentHeight:function(){return this.activeElement().parent().height()},parentAspectRatio:function(){return this.parentWidth()/this.parentHeight()},_updateStretch:function(){var a=null;if(this.get("stretch")){var b=this.aspectRatio();if(isFinite(b)){var c=this.parentAspectRatio();isFinite(c)?(c>b&&(a="height"),b>c&&(a="width")):c===1/0&&(a="height")}}this.__currentStretch!==a&&(this.__currentStretch&&this.activeElement().removeClass(this.get("css")+"-stretch-"+this.__currentStretch),a&&this.activeElement().addClass(this.get("css")+"-stretch-"+a)),this.__currentStretch=a}}},{playerStates:function(){return[n]}}).register("ba-videoplayer").attachStringTable(c.strings).addStrings({"video-error":"An error occurred, please try again later. Click to retry."})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.State",["base:States.State","base:Events.ListenMixin","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},[b,{dynamics:[],_start:function(){this.dyn=this.host.dynamic,c.iter(c.extend({loader:!1,message:!1,playbutton:!1,controlbar:!1},c.objectify(this.dynamics)),function(a,b){this.dyn.set(b+"_active",a)},this),this._started()},_started:function(){},play:function(){this.dyn.set("autoplay",!0)}}])}),a.define("module:VideoPlayer.Dynamics.PlayerStates.FatalError",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["message"],_locals:["message"],_started:function(){this.dyn.set("message",this._message||this.dyn.string("video-error"))}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.Initial",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["loader"],_started:function(){this.dyn.get("ready")?this.next("LoadPlayer"):this.listenOn(this.dyn,"change:ready",function(){this.next("LoadPlayer")})}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.LoadPlayer",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["loader"],_started:function(){this.listenOn(this.dyn,"error:attach",function(){this.next("LoadError")},this),this.listenOn(this.dyn,"error:poster",function(){this.dyn.get("states").poster_error.ignore||this.next("PosterError")},this),this.listenOn(this.dyn,"attached",function(){this.next("PosterReady")},this),this.dyn.reattachVideo()}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.LoadError",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["message"],_started:function(){this.dyn.set("message",this.dyn.string("video-error")),this.listenOn(this.dyn,"message:click",function(){this.next("LoadPlayer")},this)}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.PosterReady",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["playbutton"],_started:function(){this.listenOn(this.dyn,"error:poster",function(){this.dyn.get("states").poster_error.ignore||this.next("PosterError")},this),(this.dyn.get("autoplay")||this.dyn.get("skipinitial"))&&this.play()},play:function(){this.next("Preroll")}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.Preroll",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:[],_started:function(){this.dyn._prerollAd?(this.dyn._prerollAd.once("finished",function(){this.next("LoadVideo")},this),this.dyn._prerollAd.executeAd({width:this.dyn.videoWidth(),height:this.dyn.videoHeight()})):this.next("LoadVideo")}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.PosterError",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["message"],_started:function(){this.dyn.set("message",this.dyn.string("video-error")),this.listenOn(this.dyn,"message:click",function(){this.next(this.dyn.get("states").poster_error.click_play?"LoadVideo":"LoadPlayer")},this)}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.LoadVideo",["module:VideoPlayer.Dynamics.PlayerStates.State","base:Async"],function(a,b,c){return a.extend({scoped:c},{dynamics:["loader"],_started:function(){this.listenOn(this.dyn,"error:video",function(){this.next("ErrorVideo")},this),this.listenOn(this.dyn,"playing",function(){this.destroyed()||this.dyn.destroyed()||(this.dyn.get("autoseek")&&this.dyn.execute("seek",this.dyn.get("autoseek")),this.next("PlayVideo"))},this),this.dyn.get("skipinitial")&&!this.dyn.get("autoplay")?this.next("PlayVideo"):this.dyn.player.play()}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.ErrorVideo",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["message"],_started:function(){this.dyn.set("message",this.dyn.string("video-error")),this.listenOn(this.dyn,"message:click",function(){this.next("LoadVideo")},this)}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.PlayVideo",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["controlbar"],_started:function(){this.dyn.set("autoplay",!1),this.listenOn(this.dyn,"change:currentstream",function(){this.dyn.set("autoplay",!0),this.dyn.set("autoseek",this.dyn.player.position()),this.dyn.reattachVideo(),this.next("LoadPlayer")},this),this.listenOn(this.dyn,"ended",function(){this.dyn.set("autoseek",null),this.next("NextVideo")},this),this.listenOn(this.dyn,"change:buffering",function(){this.dyn.set("loader_active",this.dyn.get("buffering"))},this),this.listenOn(this.dyn,"error:video",function(){this.next("ErrorVideo")},this)},play:function(){this.dyn.get("playing")||this.dyn.player.play()}})}),a.define("module:VideoPlayer.Dynamics.PlayerStates.NextVideo",["module:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{_started:function(){if(this.dyn.get("playlist")){var a=this.dyn.get("playlist"),b=a.shift();if(this.dyn.get("loop")&&a.push(b),this.dyn.set("playlist",a),a.length>0){var c=a[0];return this.dyn.set("poster",c.poster),this.dyn.set("source",c.source),this.dyn.set("sources",c.sources),this.dyn.reattachVideo(),this.dyn.set("autoplay",!0),void this.next("LoadPlayer")}}this.next("PosterReady")}})}),a.define("module:VideoPlayer.Dynamics.Topmessage",["dynamics:Dynamic","module:Templates"],function(a,b,c){return a.extend({scoped:c},function(a){return{template:b.video_player_topmessage,attrs:{css:"ba-videoplayer",topmessage:""}}}).register("ba-videoplayer-topmessage")}),a.define("module:VideoRecorder.Dynamics.Chooser",["dynamics:Dynamic","module:Templates","module:Assets","browser:Info"],["dynamics:Partials.ClickPartial","dynamics:Partials.IfPartial"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{template:b.video_recorder_chooser,attrs:{css:"ba-videorecorder",allowrecord:!0,allowupload:!0,allowcustomupload:!0,primaryrecord:!0},create:function(){this.set("has_primary",!0),this.set("enable_primary_select",!1),this.set("primary_label",this.string(this.get("primaryrecord")&&this.get("allowrecord")?"record-video":"upload-video")),this.set("secondary_label",this.string(this.get("primaryrecord")?"upload-video":"record-video")),this.get("allowrecord")&&this.get("primaryrecord")&&(!d.isMobile()||d.isAndroid()&&d.isCordova())||(this.set("enable_primary_select",!0),this.set("primary_select_capture",d.isMobile()&&this.get("allowrecord")&&this.get("primaryrecord")),this.set("primary_accept_string",d.isMobile()&&this.get("allowrecord")&&this.get("primaryrecord")?"video/*,video/mp4;capture=camcorder":d.isMobile()||!this.get("allowcustomupload")?"video/*,video/mp4":"")),this.set("has_secondary",this.get("allowrecord")&&this.get("allowupload")),this.set("enable_secondary_select",!1),!this.get("primaryrecord")&&(!d.isMobile()||d.isAndroid()&&d.isCordova())||(this.set("enable_secondary_select",!0),this.set("secondary_select_capture",d.isMobile()&&!this.get("primaryrecord")),this.set("secondary_accept_string",d.isMobile()&&!this.get("primaryrecord")?"video/*,video/mp4;capture=camcorder":d.isMobile()||!this.get("allowcustomupload")?"video/*,video/mp4":""))},__recordCordova:function(){var a=this;navigator.device.capture.captureVideo(function(b){var c=b[0];a.trigger("upload",c)},function(a){},{limit:1})},functions:{primary:function(){this.get("enable_primary_select")||(d.isMobile()&&d.isAndroid()&&d.isCordova()?this.__recordCordova():this.trigger("record"))},secondary:function(){this.get("enable_secondary_select")||(d.isMobile()&&d.isAndroid()&&d.isCordova()?this.__recordCordova():this.trigger("record"))},primary_select:function(a){this.get("enable_primary_select")&&this.trigger("upload",a[0].target)},secondary_select:function(a){this.get("enable_secondary_select")&&this.trigger("upload",a[0].target)}}}}).register("ba-videorecorder-chooser").attachStringTable(c.strings).addStrings({"record-video":"Record Your Video","upload-video":"Upload Video"})}),a.define("module:VideoRecorder.Dynamics.Controlbar",["dynamics:Dynamic","module:Templates","module:Assets","base:Timers.Timer"],["dynamics:Partials.ShowPartial","dynamics:Partials.RepeatPartial"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{template:b.video_recorder_controlbar,attrs:{css:"ba-videorecorder",hovermessage:"",recordingindication:!0,covershot_accept_string:"image/*,image/png,image/jpg,image/jpeg"},create:function(){this.auto_destroy(new d({context:this,fire:function(){this.set("recordingindication",!this.get("recordingindication"))},delay:500}))},functions:{selectCamera:function(a){this.trigger("select-camera",a)},selectMicrophone:function(a){this.trigger("select-microphone",a)},hover:function(a){this.set("hovermessage",a)},unhover:function(){this.set("hovermessage","")},record:function(){this.trigger("invoke-record")},rerecord:function(){this.trigger("invoke-rerecord")},stop:function(){this.trigger("invoke-stop")},skip:function(){this.trigger("invoke-skip")},uploadCovershot:function(a){this.trigger("upload-covershot",a[0].target)}}}}).register("ba-videorecorder-controlbar").attachStringTable(c.strings).addStrings({settings:"Settings",camerahealthy:"Lighting is good",cameraunhealthy:"Lighting is not optimal",microphonehealthy:"Sound is good",microphoneunhealthy:"Cannot pick up any sound",record:"Record","record-tooltip":"Click here to record.",rerecord:"Redo","rerecord-tooltip":"Click here to redo.","upload-covershot":"Upload","upload-covershot-tooltip":"Click here to upload custom cover shot",stop:"Stop","stop-tooltip":"Click here to stop.",skip:"Skip","skip-tooltip":"Click here to skip."})}),a.define("module:VideoRecorder.Dynamics.Imagegallery",["dynamics:Dynamic","module:Templates","base:Collections.Collection","base:Properties.Properties","jquery:","base:Timers.Timer"],["dynamics:Partials.StylesPartial"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},function(a){return{template:b.video_recorder_imagegallery,attrs:{css:"ba-videorecorder",imagecount:3,imagenativewidth:0,imagenativeheight:0,containerwidth:0,containerheight:0,containeroffset:0,deltafrac:1/8},computed:{"imagewidth:imagecount,containerwidth,deltafrac":function(){return this.get("imagecount")<=0?0:this.get("containerwidth")*(1-this.get("deltafrac"))/this.get("imagecount")},"imagedelta:imagecount,containerwidth,deltafrac":function(){return this.get("imagecount")<=1?0:this.get("containerwidth")*this.get("deltafrac")/(this.get("imagecount")-1)},"imageheight:imagewidth,imagenativewidth,imagenativeheight":function(){return this.get("imagenativeheight")*this.get("imagewidth")/this.get("imagenativewidth")}},create:function(){var a=this.auto_destroy(new c);this.set("images",a),this.snapshotindex=0,this._updateImageCount(),this.on("change:imagecount",this._updateImageCount,this),this.on("change:imagewidth change:imageheight change:imagedelta",this._recomputeImageBoxes,this),this.auto_destroy(new f({context:this,delay:1e3,fire:function(){this.updateContainerSize()}}))},destroy:function(){this.get("images").iterate(function(a){a.snapshotDisplay&&this.parent().recorder&&this.parent().recorder.removeSnapshotDisplay(a.snapshotDisplay)},this),a.destroy.call(this)},_updateImageCount:function(){for(var a=this.get("images"),b=this.get("imagecount");a.count()<b;){var c=new d({index:a.count()});this._recomputeImageBox(c),a.add(c)}for(;a.count()>b;)a.remove(a.getByIndex(a.count()-1))},_recomputeImageBoxes:function(){this.get("images").iterate(function(a){this._recomputeImageBox(a)},this)},_recomputeImageBox:function(a){if(this.parent().recorder){var b=a.get("index"),c=this.get("imagewidth"),d=this.get("imageheight"),e=this.get("imagedelta"),f=this.get("containerheight");a.set("left",1+Math.round(b*(c+e))),a.set("top",1+Math.round((f-d)/2)),a.set("width",1+Math.round(c)),a.set("height",1+Math.round(d)),a.snapshot&&a.snapshotDisplay&&this.parent().recorder.updateSnapshotDisplay(a.snapshot,a.snapshotDisplay,a.get("left")+this.get("containeroffset"),a.get("top"),a.get("width"),a.get("height"))}},updateContainerSize:function(){var a=this.activeElement().find("[data-gallery-container]");this.set("containeroffset",parseInt(a.position().left,10)),this.set("containerheight",parseInt(a.height(),10)),this.set("containerwidth",parseInt(a.width(),10))},_afterActivate:function(b){a._afterActivate.apply(this,arguments),this.updateContainerSize()},loadImageSnapshot:function(a,b){a.snapshotDisplay&&(this.parent().recorder.removeSnapshotDisplay(a.snapshotDisplay),a.snapshotDisplay=null);var c=this.parent().snapshots;a.snapshot=c[(b%c.length+c.length)%c.length],a.snapshotDisplay=this.parent().recorder.createSnapshotDisplay(this.activeElement().get(0),a.snapshot,a.get("left")+this.get("containeroffset"),a.get("top"),a.get("width"),a.get("height"))},loadSnapshots:function(){this.get("images").iterate(function(a){this.loadImageSnapshot(a,this.snapshotindex+a.get("index"))},this)},nextSnapshots:function(){this.snapshotindex+=this.get("imagecount"),this.loadSnapshots()},prevSnapshots:function(){this.snapshotindex-=this.get("imagecount"),this.loadSnapshots()},functions:{left:function(){this.prevSnapshots()},right:function(){this.nextSnapshots()},select:function(a){this.trigger("image-selected",a.snapshot)}}}}).register("ba-videorecorder-imagegallery")}),a.define("module:VideoRecorder.Dynamics.Loader",["dynamics:Dynamic","module:Templates"],["dynamics:Partials.ShowPartial"],function(a,b,c){return a.extend({scoped:c},function(a){return{template:b.video_recorder_loader,attrs:{css:"ba-videorecorder",tooltip:"",label:"",message:""}}}).register("ba-videorecorder-loader")}),a.define("module:VideoRecorder.Dynamics.Message",["dynamics:Dynamic","module:Templates"],["dynamics:Partials.ClickPartial"],function(a,b,c){return a.extend({scoped:c},function(a){return{template:b.video_recorder_message,attrs:{css:"ba-videorecorder",message:""},functions:{click:function(){this.trigger("click")}}}}).register("ba-videorecorder-message")}),a.define("module:VideoRecorder.Dynamics.Recorder",["dynamics:Dynamic","module:Templates","module:Assets","browser:Info","browser:Upload.MultiUploader","browser:Upload.FileUploader","media:Recorder.VideoRecorderWrapper","base:Types","base:Objs","base:Strings","base:Time","base:Timers","base:States.Host","base:Classes.ClassRegistry","base:Collections.Collection","base:Promise","module:VideoRecorder.Dynamics.RecorderStates.Initial","module:VideoRecorder.Dynamics.RecorderStates"],["module:VideoRecorder.Dynamics.Imagegallery","module:VideoRecorder.Dynamics.Loader","module:VideoRecorder.Dynamics.Controlbar","module:VideoRecorder.Dynamics.Message","module:VideoRecorder.Dynamics.Topmessage","module:VideoRecorder.Dynamics.Chooser","dynamics:Partials.ShowPartial","dynamics:Partials.IfPartial","dynamics:Partials.EventPartial","dynamics:Partials.OnPartial","dynamics:Partials.DataPartial","dynamics:Partials.AttrsPartial","dynamics:Partials.TemplatePartial"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){return a.extend({scoped:s},function(a){return{template:b.recorder,attrs:{css:"ba-videorecorder",iecss:"ba-videorecorder",cssimagegallery:"",cssloader:"",csscontrolbar:"",cssmessage:"",csstopmessage:"",csschooser:"",width:"",height:"",gallerysnapshots:3,theme:"",csstheme:"",dynimagegallery:"videorecorder-imagegallery",dynloader:"videorecorder-loader",dyncontrolbar:"videorecorder-controlbar",dynmessage:"videorecorder-message",dyntopmessage:"videorecorder-topmessage",dynchooser:"videorecorder-chooser",dynvideoplayer:"videoplayer",tmplimagegallery:"",tmplloader:"",tmplcontrolbar:"",tmplmessage:"",tmpltopmessage:"",tmplchooser:"",autorecord:!1,autoplay:!1,allowrecord:!0,allowupload:!0,allowcustomupload:!0,primaryrecord:!0,nofullscreen:!1,recordingwidth:640,recordingheight:480,countdown:3,snapshotmax:15,framerate:null,snapshottype:"jpg",picksnapshots:!0,playbacksource:"",playbackposter:"",recordermode:!0,skipinitial:!1,timelimit:null,timeminlimit:null,rtmpstreamtype:"mp4","microphone-volume":1,"flip-camera":!1,"early-rerecord":!1,"custom-covershots":!1,manualsubmit:!1,allowedextensions:null,filesizelimit:null,forceflash:!1,noflash:!1,noaudio:!1,flashincognitosupport:!1,localplayback:!1,uploadoptions:{},playerattrs:{},rerecordable:!0,recordings:null,ready:!0,stretch:!1},scopes:{player:">[id='player']"},types:{forceflash:"boolean",noflash:"boolean",rerecordable:"boolean",ready:"boolean",stretch:"boolean",autorecord:"boolean",autoplay:"boolean",allowrecord:"boolean",allowupload:"boolean",allowcustomupload:"boolean",primaryrecord:"boolean",flashincognitosupport:"boolean",recordermode:"boolean",nofullscreen:"boolean",picksnapshots:"boolean",localplayback:"boolean",noaudio:"boolean",skipinitial:"boolean","microphone-volume":"float","flip-camera":"boolean","early-rerecord":"boolean","custom-covershots":"boolean",manualsubmit:"boolean"},extendables:["states"],remove_on_destroy:!0,create:function(){this.get("theme")in c.recorderthemes&&i.iter(c.recorderthemes[this.get("theme")],function(a,b){this.isArgumentAttr(b)||this.set(b,a)},this),this.set("ie8",d.isInternetExplorer()&&d.internetExplorerVersion()<9),this.set("hideoverlay",!1),d.isMobile()&&this.set("skipinitial",!1),this.__attachRequested=!1,this.__activated=!1,this._bound=!1,this.__recording=!1,this.__error=null,this.__currentStretch=null,this.on("change:stretch",function(){this._updateStretch()},this),this.host=this.auto_destroy(new m({stateRegistry:new n(this.cls.recorderStates())})),this.host.dynamic=this,this.host.initialize(q),this._timer=this.auto_destroy(new l.Timer({context:this,fire:this._timerFire,delay:250,start:!0})),this.__cameraResponsive=!0,this.__cameraSignal=!0},state:function(){return this.host.state()},recorderAttached:function(){return!!this.recorder},videoError:function(){return this.__error},_error:function(a,b){this.__error={error_type:a,error_code:b},this.trigger("error:"+a,b),this.trigger("error",a,b)},_clearError:function(){this.__error=null},_detachRecorder:function(){this.recorder&&this.recorder.weakDestroy(),this.recorder=null,this.set("hasrecorder",!1)},_attachRecorder:function(){if(!this.recorderAttached()){if(!this.__activated)return void(this.__attachRequested=!0);this.set("hasrecorder",!0),this.snapshots=[],this.__attachRequested=!1;var a=this.element().find("[data-video='video']").get(0);this._clearError(),this.recorder=g.create({element:a,forceflash:this.get("forceflash"),noflash:this.get("noflash"),recordVideo:!0,recordAudio:!this.get("noaudio"),recordingWidth:this.get("recordingwidth"),recordingHeight:this.get("recordingheight"),flashFullSecurityDialog:!this.get("flashincognitosupport"),rtmpStreamType:this.get("rtmpstreamtype"),framerate:this.get("framerate"),flip:this.get("flip-camera")}),this.recorder||this._error("attach")}},_bindMedia:function(){!this._bound&&this.recorderAttached()&&this.recorder&&this.recorder.ready.success(function(){
this.recorder.on("require_display",function(){this.set("hideoverlay",!0)},this),this.recorder.bindMedia().error(function(a){this.trigger("access_forbidden",a),this.set("hideoverlay",!1),this.off("require_display",null,this),this._error("bind",a)},this).success(function(){for(this.trigger("access_granted"),this.recorder.setVolumeGain(this.get("microphone-volume")),this.set("hideoverlay",!1),this.off("require_display",null,this),this.recorder.enumerateDevices().success(function(a){var b=this.recorder.currentDevices();this.set("selectedcamera",b.video),this.set("selectedmicrophone",b.audio),this.set("cameras",new o(i.values(a.video))),this.set("microphones",new o(i.values(a.audio)))},this),this.get("noaudio")||this.recorder.testSoundLevel(!0),this.set("devicetesting",!0),this._updateStretch();this.snapshots.length>0;){var a=this.snapshots.unshift();this.recorder.removeSnapshot(a)}this._bound=!0,this.trigger("bound")},this)},this)},isFlash:function(){return this.recorder&&this.recorder.isFlash()},_initializeUploader:function(){this._dataUploader&&this._dataUploader.weakDestroy(),this._dataUploader=new e},_unbindMedia:function(){this._bound&&(this.recorder.unbindMedia(),this._bound=!1)},_uploadCovershot:function(a){this.__lastCovershotUpload=a;var b=this.recorder.createSnapshotUploader(a,this.get("snapshottype"),this.get("uploadoptions").image);b.upload(),this._dataUploader.addUploader(b)},_uploadCovershotFile:function(a){this.__lastCovershotUpload=a;var b=f.create(i.extend({source:a},this.get("uploadoptions").image));b.upload(),this._dataUploader.addUploader(b)},_uploadVideoFile:function(a){var b=f.create(i.extend({source:a},this.get("uploadoptions").video));b.upload(),this._dataUploader.addUploader(b)},_prepareRecording:function(){return p.create(!0)},_startRecording:function(){return this.__recording?p.error(!0):(this.get("noaudio")||this.recorder.testSoundLevel(!1),this.set("devicetesting",!1),this.recorder.startRecord({rtmp:this.get("uploadoptions").rtmp,video:this.get("uploadoptions").video,audio:this.get("uploadoptions").audio}).success(function(){this.__recording=!0,this.__recording_start_time=k.now()},this))},_stopRecording:function(){return this.__recording?this.recorder.stopRecord({rtmp:this.get("uploadoptions").rtmp,video:this.get("uploadoptions").video,audio:this.get("uploadoptions").audio}).success(function(a){this.__recording=!1,a.upload(),this._dataUploader.addUploader(a)},this):p.error(!0)},_verifyRecording:function(){return p.create(!0)},_afterActivate:function(b){a._afterActivate.call(this,b),this.__activated=!0,this.__attachRequested&&this._attachRecorder()},_showBackgroundSnapshot:function(){this._hideBackgroundSnapshot(),this.__backgroundSnapshot=this.recorder.createSnapshot(this.get("snapshottype"));var a=this.activeElement().find("[data-video]");this.__backgroundSnapshotDisplay=this.recorder.createSnapshotDisplay(a.get(0),this.__backgroundSnapshot,0,0,parseInt(a.width(),10),parseInt(a.height(),10))},_hideBackgroundSnapshot:function(){this.__backgroundSnapshotDisplay&&this.recorder.removeSnapshotDisplay(this.__backgroundSnapshotDisplay),delete this.__backgroundSnapshotDisplay,this.__backgroundSnapshot&&this.recorder.removeSnapshot(this.__backgroundSnapshot),delete this.__backgroundSnapshot},object_functions:["record","rerecord","stop","play","pause","reset"],functions:{record:function(){this.host.state().record()},record_video:function(){this.host.state().selectRecord()},upload_video:function(a){this.host.state().selectUpload(a)},upload_covershot:function(a){this.host.state().uploadCovershot(a)},select_camera:function(a){this.recorder&&(this.recorder.setCurrentDevices({video:a}),this.set("selectedcamera",a))},select_microphone:function(a){this.recorder&&(this.recorder.setCurrentDevices({audio:a}),this.recorder.testSoundLevel(!0),this.set("selectedmicrophone",a)),this.set("microphonehealthy",!1)},invoke_skip:function(){this.trigger("invoke-skip")},select_image:function(a){this.trigger("select-image",a)},rerecord:function(){confirm(this.string("rerecord-confirm"))&&this.host.state().rerecord()},stop:function(){this.host.state().stop()},play:function(){this.host.state().play()},pause:function(){this.host.state().pause()},message_click:function(){this.trigger("message-click")},playing:function(){this.trigger("playing")},paused:function(){this.trigger("paused")},ended:function(){this.trigger("ended")},reset:function(){this._stopRecording().callback(function(){this._detachRecorder(),this.host.state().next("Initial")},this)},manual_submit:function(){this.set("rerecordable",!1),this.set("manualsubmit",!1),this.trigger("manually_submitted")}},destroy:function(){this._detachRecorder(),a.destroy.call(this)},deltaCoefficient:function(){return this.recorderAttached()?this.recorder.deltaCoefficient():null},blankLevel:function(){return this.recorderAttached()?this.recorder.blankLevel():null},lightLevel:function(){return this.recorderAttached()?this.recorder.lightLevel():null},soundLevel:function(){return this.recorderAttached()?this.recorder.soundLevel():null},_timerFire:function(){try{if(this.recorderAttached()&&this.get("devicetesting")){var a=this.lightLevel();this.set("camerahealthy",a>=100&&200>=a),!this.get("noaudio")&&!this.get("microphonehealthy")&&this.soundLevel()>=1.01&&(this.set("microphonehealthy",!0),this.recorder.testSoundLevel(!1))}}catch(b){}if(this.__recording&&this.__recording_start_time+500<k.now()){var c=this.snapshots.length<this.get("snapshotmax")?.25:.05;if(Math.random()<=c){var d=this.recorder.createSnapshot(this.get("snapshottype"));if(d)if(this.snapshots.length<this.get("snapshotmax"))this.snapshots.push(d);else{var e=Math.floor(Math.random()*this.get("snapshotmax"));this.recorder.removeSnapshot(this.snapshots[e]),this.snapshots[e]=d}}}try{if(this.recorderAttached()&&this._timer.fire_count()%20===0&&this._accessing_camera){var f=this.blankLevel()>=.01;f!==this.__cameraSignal&&(this.__cameraSignal=f,this.trigger(f?"camera_signal":"camera_nosignal"))}if(this.recorderAttached()&&this._timer.fire_count()%20===10&&this._accessing_camera){var g=this.recorder.deltaCoefficient(),h=null===g||g>=.5;h!==this.__cameraResponsive&&(this.__cameraResponsive=h,this.trigger(h?"camera_responsive":"camera_unresponsive"))}}catch(b){}this._updateStretch(),this._updateCSSSize()},_updateCSSSize:function(){this.set("csssize",this.element().width()>400?"normal":this.element().width()>300?"medium":"small")},videoHeight:function(){return this.recorderAttached()?this.recorder.cameraHeight():NaN},videoWidth:function(){return this.recorderAttached()?this.recorder.cameraWidth():NaN},aspectRatio:function(){return this.videoWidth()/this.videoHeight()},parentWidth:function(){return this.get("width")||this.activeElement().width()},parentHeight:function(){return this.get("height")||this.activeElement().height()},parentAspectRatio:function(){return this.parentWidth()/this.parentHeight()},averageFrameRate:function(){return this.recorderAttached()?this.recorder.averageFrameRate():null},_updateStretch:function(){var a=null;if(this.get("stretch")){var b=this.aspectRatio();if(isFinite(b)){var c=this.parentAspectRatio();isFinite(c)?(c>b&&(a="height"),b>c&&(a="width")):c===1/0&&(a="height")}}this.__currentStretch!==a&&(this.__currentStretch&&this.activeElement().removeClass(this.get("css")+"-stretch-"+this.__currentStretch),a&&this.activeElement().addClass(this.get("css")+"-stretch-"+a)),this.__currentStretch=a}}},{recorderStates:function(){return[r]}}).register("ba-videorecorder").attachStringTable(c.strings).addStrings({"recorder-error":"An error occurred, please try again later. Click to retry.","attach-error":"We could not access the camera interface. Depending on the device and browser, you might need to install Flash or access the page via SSL.","access-forbidden":"Access to the camera was forbidden. Click to retry.","pick-covershot":"Pick a covershot.",uploading:"Uploading","uploading-failed":"Uploading failed - click here to retry.",verifying:"Verifying","verifying-failed":"Verifying failed - click here to retry.","rerecord-confirm":"Do you really want to redo your video?",video_file_too_large:"Your video file is too large - click here to try again with a smaller video file.",unsupported_video_type:"Please upload: %s - click here to retry."})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.State",["base:States.State","base:Events.ListenMixin","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},[b,{dynamics:[],_start:function(){this.dyn=this.host.dynamic,c.iter(c.extend({message:!1,chooser:!1,topmessage:!1,controlbar:!1,loader:!1,imagegallery:!1},c.objectify(this.dynamics)),function(a,b){this.dyn.set(b+"_active",a)},this),this.dyn.set("playertopmessage",""),this.dyn._accessing_camera=!1,this._started()},_started:function(){},record:function(){this.dyn.set("autorecord",!0)},stop:function(){this.dyn.scopes.player.execute("stop")},play:function(){this.dyn.scopes.player.execute("play")},pause:function(){this.dyn.scopes.player.execute("pause")},rerecord:function(){},selectRecord:function(){},selectUpload:function(a){},uploadCovershot:function(a){}}])}),a.define("module:VideoRecorder.Dynamics.RecorderStates.FatalError",["module:VideoRecorder.Dynamics.RecorderStates.State","browser:Info","base:Timers.Timer"],function(a,b,c,d){return a.extend({scoped:d},{dynamics:["message"],_locals:["message","retry","flashtest"],_started:function(){this.dyn.set("message",this._message||this.dyn.string("recorder-error")),this.listenOn(this.dyn,"message-click",function(){this._retry&&this.next(this._retry)}),this._flashtest&&!b.isMobile()&&b.flash().supported()&&!b.flash().installed()&&(this.auto_destroy(new c({delay:500,context:this,fire:function(){b.flash(!0).installed()&&this.next(this._retry)}})),b.isSafari()&&b.safariVersion()>=10&&(document.location.href="//get.adobe.com/flashplayer"))}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.Initial",["module:VideoRecorder.Dynamics.RecorderStates.State"],function(a,b){return a.extend({scoped:b},{_started:function(){this.dyn.set("player_active",!1),this.dyn._initializeUploader(),this.dyn.get("recordermode")?this.dyn.get("autorecord")||this.dyn.get("skipinitial")?this.eventualNext("CameraAccess"):this.next("Chooser"):this.next("Player")}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.Player",["module:VideoRecorder.Dynamics.RecorderStates.State"],function(a,b){return a.extend({scoped:b},{rerecord:function(){this.dyn.trigger("rerecord"),this.dyn.set("recordermode",!0),this.next("Initial")},_started:function(){this.dyn.set("player_active",!0)},_end:function(){this.dyn.set("player_active",!1)}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.Chooser",["module:VideoRecorder.Dynamics.RecorderStates.State","jquery:","base:Strings","browser:Info"],function(a,b,c,d,e){return a.extend({scoped:e},{dynamics:["chooser"],record:function(){this.dyn.set("autorecord",!0),this.selectRecord()},selectRecord:function(){this.next("CameraAccess")},selectUpload:function(a){if(!(d.isMobile()&&d.isAndroid()&&d.isCordova())){if(this.dyn.get("allowedextensions")){var e=b(a).val().toLowerCase(),f=!1;if(this.dyn.get("allowedextensions").forEach(function(a){c.ends_with(e,"."+a.toLowerCase())&&(f=!0)},this),!f)return void this.next("FatalError",{message:this.dyn.strings("unsupported_video_type").replace("%s",this.dyn.get("allowedextensions").join(" / ")),retry:"Chooser"})}if(this.dyn.get("filesizelimit")){var g=a;if(g.files&&g.files.length>0&&g.files[0].size>this.dyn.get("filesizelimit"))return void this.next("FatalError",{message:this.dyn.strings("video_file_too_large"),retry:"Chooser"})}}this.dyn._prepareRecording().success(function(){this.dyn._uploadVideoFile(a),this.next("Uploading")},this).error(function(a){this.next("FatalError",{message:a,retry:"Chooser"})},this)}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.CameraAccess",["module:VideoRecorder.Dynamics.RecorderStates.State","base:Timers.Timer"],function(a,b,c){return a.extend({scoped:c},{dynamics:["loader"],_started:function(){this.dyn.set("settingsvisible",!0),this.dyn.set("recordvisible",!0),this.dyn.set("rerecordvisible",!1),this.dyn.set("stopvisible",!1),this.dyn.set("skipvisible",!1),this.dyn.set("controlbarlabel",""),this.listenOn(this.dyn,"bound",function(){var a=this.auto_destroy(new b({start:!0,delay:100,context:this,fire:function(){this.dyn.recorder.blankLevel()>=.01&&this.dyn.recorder.deltaCoefficient()>=.01&&(a.stop(),this.next("CameraHasAccess"))}}))},this),this.listenOn(this.dyn,"error",function(a){this.next("FatalError",{message:this.dyn.string("attach-error"),retry:"Initial",flashtest:!0})},this),this.listenOn(this.dyn,"access_forbidden",function(){this.next("FatalError",{message:this.dyn.string("access-forbidden"),retry:"Initial"})},this),this.dyn._attachRecorder(),this.dyn&&this.dyn._bindMedia()}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.CameraHasAccess",["module:VideoRecorder.Dynamics.RecorderStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["topmessage","controlbar"],_started:function(){this.dyn.set("settingsvisible",!0),this.dyn.set("recordvisible",!0),this.dyn.set("rerecordvisible",!1),this.dyn.set("stopvisible",!1),this.dyn.set("skipvisible",!1),this.dyn.set("controlbarlabel",""),this.dyn.get("autorecord")&&this.next("RecordPrepare")},record:function(){this.dyn.get("autorecord")||this.next("RecordPrepare")}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.RecordPrepare",["module:VideoRecorder.Dynamics.RecorderStates.State","base:Timers.Timer","base:Time"],function(a,b,c,d){return a.extend({scoped:d},{dynamics:["loader"],_started:function(){if(this.dyn._accessing_camera=!0,this._promise=this.dyn._prepareRecording(),this.dyn.set("message",""),this.dyn.get("countdown")){this.dyn.set("loaderlabel",this.dyn.get("countdown"));var a=c.now()+1e3*this.dyn.get("countdown"),d=new b({context:this,delay:100,fire:function(){var b=Math.max(0,a-c.now());this.dyn.set("loaderlabel",""+Math.round(b/1e3)),this.dyn.trigger("countdown",b),a<=c.now()&&(this.dyn.set("loaderlabel",""),d.stop(),this._startRecording())}});this.auto_destroy(d)}else this._startRecording()},record:function(){this._startRecording()},_startRecording:function(){this._promise.success(function(){this.dyn._startRecording().success(function(){this.next("Recording")},this).error(function(a){this.next("FatalError",{message:a,retry:"CameraAccess"})},this)},this).error(function(a){this.next("FatalError",{message:a,retry:"CameraAccess"})},this)}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.Recording",["module:VideoRecorder.Dynamics.RecorderStates.State","base:Timers.Timer","base:Time","base:TimeFormat"],function(a,b,c,d,e){return a.extend({scoped:e},{dynamics:["topmessage","controlbar"],_started:function(){this.dyn._accessing_camera=!0,this.dyn.trigger("recording"),this.dyn.set("settingsvisible",!1),this.dyn.set("rerecordvisible",!1),this.dyn.set("recordvisible",!1),this.dyn.set("stopvisible",!0),this.dyn.set("skipvisible",!1),this._startTime=c.now(),this._stopping=!1,this._timer=this.auto_destroy(new b({immediate:!0,delay:10,context:this,fire:this._timerFire}))},_timerFire:function(){var a=this.dyn.get("timelimit"),b=c.now(),e=Math.max(0,a?this._startTime+1e3*a-b:b-this._startTime);this.dyn.set("controlbarlabel",d.format(d.ELAPSED_MINUTES_SECONDS,e)),a&&this._startTime+1e3*a<=b&&(this._timer.stop(),this.stop())},stop:function(){var a=this.dyn.get("timeminlimit");if(a){var b=c.now()-this._startTime;if(a>b){var d=this.dyn.get("timelimit");if(!d||d>b)return}}this._stopping||(this._stopping=!0,this.dyn._stopRecording().success(function(){this.dyn._showBackgroundSnapshot(),this.dyn._unbindMedia(),this.dyn.trigger("recording_stopped"),this.dyn.get("picksnapshots")&&this.dyn.snapshots.length>=this.dyn.get("gallerysnapshots")?this.next("CovershotSelection"):this.next("Uploading")},this).error(function(a){this.next("FatalError",{message:a,retry:"CameraAccess"})},this))}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.CovershotSelection",["module:VideoRecorder.Dynamics.RecorderStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["imagegallery","topmessage","controlbar"],_started:function(){this.dyn.set("settingsvisible",!1),this.dyn.set("recordvisible",!1),this.dyn.set("stopvisible",!1),this.dyn.set("skipvisible",!0),this.dyn.set("controlbarlabel",""),this.dyn.set("rerecordvisible",this.dyn.get("early-rerecord")),this.dyn.set("uploadcovershotvisible",this.dyn.get("custom-covershots")),this.dyn.set("topmessage",this.dyn.string("pick-covershot"));var a=this.dyn.scope(">[tagname='ba-videorecorder-imagegallery']").materialize(!0);a.loadSnapshots(),a.updateContainerSize(),this.listenOn(this.dyn,"invoke-skip",function(){this.next("Uploading")},this),this.listenOn(this.dyn,"select-image",function(a){this.dyn._uploadCovershot(a),this.next("Uploading")},this)},rerecord:function(){this.dyn._hideBackgroundSnapshot(),this.dyn._detachRecorder(),this.dyn.trigger("rerecord"),this.dyn.set("recordermode",!0),this.next("Initial")},uploadCovershot:function(a){this.dyn._uploadCovershotFile(a),this.next("Uploading")}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.Uploading",["module:VideoRecorder.Dynamics.RecorderStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["loader","message"],_started:function(){this.dyn.trigger("uploading"),this.dyn.set("rerecordvisible",this.dyn.get("early-rerecord")),this.dyn.get("early-rerecord")&&this.dyn.set("controlbar_active",!0),this.dyn.set("topmessage",""),this.dyn.set("message",this.dyn.string("uploading")),this.dyn.set("playertopmessage",this.dyn.get("message"));var a=this.dyn._dataUploader;this.listenOn(a,"success",function(){this.dyn.trigger("uploaded"),this.next("Verifying")}),this.listenOn(a,"error",function(){this.dyn.set("player_active",!1),this.next("FatalError",{message:this.dyn.string("uploading-failed"),retry:this.dyn.recorderAttached()?"Uploading":"Initial"})}),this.listenOn(a,"progress",function(a,b){0!==b&&(this.dyn.trigger("upload_progress",a/b),this.dyn.set("message",this.dyn.string("uploading")+": "+Math.round(a/b*100)+"%"),this.dyn.set("playertopmessage",this.dyn.get("message")))}),this.dyn.get("localplayback")&&this.dyn.recorder&&this.dyn.recorder.supportsLocalPlayback()&&(this.dyn.set("playbacksource",this.dyn.recorder.localPlaybackSource()),this.dyn.__lastCovershotUpload&&this.dyn.set("playbackposter",this.dyn.recorder.snapshotToLocalPoster(this.dyn.__lastCovershotUpload)),this.dyn.set("loader_active",!1),this.dyn.set("message_active",!1),this.dyn._hideBackgroundSnapshot(),this.dyn.set("player_active",!0)),a.reset(),a.upload()},rerecord:function(){this.dyn._hideBackgroundSnapshot(),this.dyn._detachRecorder(),this.dyn.trigger("rerecord"),this.dyn.set("recordermode",!0),this.next("Initial")}})}),a.define("module:VideoRecorder.Dynamics.RecorderStates.Verifying",["module:VideoRecorder.Dynamics.RecorderStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["loader","message"],_started:function(){this.dyn.trigger("verifying"),this.dyn.set("message",this.dyn.string("verifying")+"..."),this.dyn.set("playertopmessage",this.dyn.get("message")),this.dyn.get("localplayback")&&this.dyn.recorder&&this.dyn.recorder.supportsLocalPlayback()?(this.dyn.set("loader_active",!1),this.dyn.set("message_active",!1)):(this.dyn.set("rerecordvisible",this.dyn.get("early-rerecord")),this.dyn.get("early-rerecord")&&this.dyn.set("controlbar_active",!0)),this.dyn._verifyRecording().success(function(){this.dyn.trigger("verified"),this.dyn._hideBackgroundSnapshot(),this.dyn._detachRecorder(),this.dyn.get("recordings")&&this.dyn.set("recordings",this.dyn.get("recordings")-1),this.next("Player")},this).error(function(){this.dyn.set("player_active",!1),this.next("FatalError",{message:this.dyn.string("verifying-failed"),retry:this.dyn.recorderAttached()?"Verifying":"Initial"})},this)},rerecord:function(){this.dyn._hideBackgroundSnapshot(),this.dyn._detachRecorder(),this.dyn.trigger("rerecord"),this.dyn.set("recordermode",!0),this.next("Initial")}})}),a.define("module:VideoRecorder.Dynamics.Topmessage",["dynamics:Dynamic","module:Templates"],function(a,b,c){return a.extend({scoped:c},function(a){return{template:b.video_recorder_topmessage,attrs:{css:"ba-videorecorder",topmessage:""}}}).register("ba-videorecorder-topmessage")})}).call(Scoped);